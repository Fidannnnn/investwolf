{% extends "base.html" %}
{% block content %}
<div class="page card">
  <h2>Feed</h2>
  <div class="post-editor card">
    <h3>Create post</h3>
    <textarea id="post-text" placeholder="Share something..." rows="3"></textarea>
    <div class="row">
      <select id="post-symbol">
        <option value="">-- optional symbol --</option>
        {% for s in ["AAPL","MSFT","TSLA"] %}
        <option value="{{s}}">{{s}}</option>
        {% endfor %}
      </select>
      <button id="btn-post">Post</button>
    </div>
  </div>

  <div id="posts-list">
    {% for p in posts %}
    <div class="post card">
      <div class="post-header">
        <img class="avatar" src="{{ (users | selectattr('id','equalto', p.user_id) | list)[0].avatar }}" />
        <div>
          <a href="/profile/{{ (users | selectattr('id','equalto', p.user_id) | list)[0].username }}">{{ (users | selectattr('id','equalto', p.user_id) | list)[0].name }}</a>
          <div class="ts">{{ p.ts }}</div>
        </div>
      </div>
      <div class="post-body">{{ p.text }}</div>
      {% if p.symbol %}
      <div class="post-action">Symbol: <a href="/stock/{{ p.symbol }}">{{ p.symbol }}</a> â€” {{ p.action }}</div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}